<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>TORCS: src/doc/architecture.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Ticon.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">TORCS
   &#160;<span id="projectnumber">1.3.7</span>
   </div>
   <div id="projectbrief">The Open Racing Car Simulator</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('architecture_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">src/doc/architecture.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="architecture_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;Architecture Overview {#architecture}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;=====================</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;The goal of this chapter is to give an introduction into the major TORCS </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;concepts and components, and to document where you find them in the source tree.</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;The TORCS architecture view presented here identifies 3 major </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;component types. These are components responsible for controlling the major </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;program flow (Orchestration), interfaces and libraries with common code (TORCS </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;API and Libraries) and modules loaded during run time (Plugins).</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;![Architecture Overview](@ref architecture.png)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Entry Stage</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;-----------</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;At start up TORCS goes first through the Entry stage. During this </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;stage the command line is analysed, and depending on the desired operation mode </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;TORCS is run either with a command line specified race configuration file in </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;command line mode (option -r), or the graphical menu is started. The command </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;line mode does not output any graphics, and the simulation time is not </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;synchronized with real time, so this mode is ideal to run simulations without </div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;human supervisor as fast as possible. The relevant code is in </div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;[src/linux/main.cpp](@ref src/linux/main.cpp) for Posix systems, or in</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;[src/windows/main.cpp](@ref src/windows/main.cpp) for Windows systems.</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;The command line mode starts up directly the State Engine </div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;in src/libs/raceengineclient/raceinit.cpp,</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;[ReRunRaceOnConsole](@ref raceinit.cpp#ReRunRaceOnConsole), it is an </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;excellent starting point to review the minimum required setup to start up, run </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;and shutdown the simulation.</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;Menu</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;----</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;The Menu and its components are responsible to offer a visual user interface to </div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;ease the setup of TORCS, e.g. the selection of predefined races, changing the </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;selection of robots, graphics and much more. All these settings are persisted </div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;in XML files and are read later by the respective components. </div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;The Race menu is a special menu, because the entries presented here are the </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;direct reflection of Race Manager configuration files (look up src/raceman). </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;You can completely customize the Race Manager configuration files if desired </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;(that means adding, removing, renaming and editing), they offer the creation of </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;very simple sessions (e.g. practice.xml) up to full championships </div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;(e.g. champ.xml).</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;When the user finally selects a Race Manager the State Engine is started up in </div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;src/libs/raceengineclient/raceinit.cpp,</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;[reSelectRaceman](@ref raceinit.cpp#reSelectRaceman).</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;State Engine</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;------------</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;The State Engine controls the execution of the Race manager specific </div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;configuration, setup, run and shutdown of the simulation </div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;(src/libs/raceengineclient/racestate.cpp,</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;[ReStateManage](@ref racestate.cpp#ReStateManage)). To trigger state </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;changes the state of TORCS data can be inspected or for more simple cases the </div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;return value of a function call can be considered. Understanding of the State</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;Engine can make some tasks really simple, e.g. implementing a robot which can</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;restart the simulation by itself (not supported  by TORCS out of the box, but</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;very easy to add, see </div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;[TORCS FAQ 6.8](http://torcs.sourceforge.net/index.php?name=Sections&amp;op=viewarticle&amp;artid=30#c6_8)).</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;![State Engine](@ref raceenginestate.gif)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;TORCS API and Libraries</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;-----------------------</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;TORCS defines some interfaces and libraries which are used in multiple parts of </div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;the project, e.g. XML parameter file handling, common functions for robots, </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;etc. The header files for the interfaces can be found in</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;[src/interfaces](@ref src/interfaces), the </div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;libraries in [src/libs](@ref src/libs), the most interesting ones for robot programming are </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;[parameter handling](@ref params), [robottools](@ref robottools), [portability](@ref src/libs/portability),</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;[math](@ref src/libs/math) and [learning](@ref src/libs/learning).</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;Plugins</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;-------</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;The Plugins share all in common that they have specified interfaces and are </div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;loaded based on the configuration during run time, so if you have an alternative </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;plugin you can configure TORCS to use it. As example there are two simulation </div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;implementations, [simuv2](@ref src/modules/simu/simuv2) and simuv3, you can</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;simply change a configuration </div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;file to change it. Typical use cases are replacing some of the actual modules </div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;with wrappers or adapters, e.g. to run the simulation on MATLAB or to run </div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;robots with simulated sensors over the network on other machines </div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;([SCR](http://scr.geccocompetitions.com)). The interface definitions can be</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;reviewed [here](@ref modint).</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;### Rendering #</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;Rendering (@ref graphicmodint) is responsible for rendering the situation. The current default </div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;implementation does visual 3D rendering including sound, based on the OpenGL </div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;1.3 and OpenAL API&#39;s. The interface is specified in src/interfaces/graphic.h. </div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;The major function is [refresh](@ref tfGraphicRefresh), which takes as argument </div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;a [struct Situation *](@ref Situation) </div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;and renders it. The code of the actual module is located in </div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;[src/modules/graphic/ssggraph](@ref src/modules/graphic/ssggraph).</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;### Simulation #</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;Simulation (@ref simumodint) is responsible for progressing the situation by a given time step. </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;The interface is specified in src/interfaces/simu.h. The major function is </div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;[update](@ref tfSimUpdate), which takes the [struct Situation *](@ref Situation) </div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;and simulation timestep (usually [RCM_MAX_DT_SIMU](@ref RCM_MAX_DT_SIMU)) </div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;as argument, and progresses the simulation by the time step. The code of the </div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;default module is located in [src/modules/simu/simuv2](@ref src/modules/simu/simuv2).</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;### Track #</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;Track (@ref trackmodint) is responsible for loading tracks into the TORCS tTrack structure. The </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;interface is specified in src/interfaces/track.h. The code of the default module </div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;is located in [src/modules/track](@ref src/modules/track).</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;### Robot #</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;The robot module(s) (@ref robotmodint) drive the cars in the simulation. TORCS can load multiple </div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;robots at the same time to drive multiple cars, one robot supports up to 10 </div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;cars at once. The major function is [rbDrive](@ref tfRbDrive), which takes as </div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;argument an index </div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;of the car to drive with the call, a [tCarElt *](@ref tCarElt) containing </div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;information about </div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;the car and a [struct Situation *](@ref Situation) containing the situation. </div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;As result the call fills </div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;in the tCarCtrl struct, which contains commands to drive the car (steer, </div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;brake, accelerator,clutch, ...). The interface is specified in </div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;src/interfaces/robot.h. Various drivers implementations are shipped with TORCS, </div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;have a look into src/drivers. Specially to mention is the &quot;Human Driver&quot; </div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;(human), it takes input from the user to control the car, so if your experiment </div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;requires adoption regarding user input have a look at this robot.</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;The Olethros and bt robot are able to adopt to the track over time and persist </div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;the gained knowledge for later runs. If you are interested in other </div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;implementations, you can find more robots on </div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;[The TORCS Racing Board](http://www.berniw.org/trb) (you can </div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;download robots of past events) or on the </div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;[SCR](http://scr.geccocompetitions.com) site.</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;Simulation Loop Internals</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;=========================</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;After discussing the TORCS architecture we are now ready to dig into some </div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;details of the simulation loop. This seems to be a topic which is usually not </div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;too easy to understand. Let start with taking about time. There are two </div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;different times in TORCS, simulation time and real time. The simulation time is </div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;basically just the time axis on which we calculate the simulation intermediate </div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;results, so if it takes 1 real minute or 1 real ms to simulate 1s in simulation </div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;time, the simulation time is just one second, real time does not matter. Real </div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;time in contrary is the time observed by the user. So it is very important to </div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;understand that the whole TORCS architecture just uses simulation time to perform </div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;calculations, evaluation of rules etc., real time does not matter in that </div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;respect. Real time is only used to synchronize in some modes simulation time </div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;with real time, e.g. to enable a human to drive a car.</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;The TORCS Simulation Loop starts in the State Engine, </div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;src/libs/raceengineclient/racestate.cpp, </div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;[ReStateManage](@ref racestate.cpp#ReStateManage),</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;case [RE_STATE_RACE](@ref RE_STATE_RACE). In </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;mode=ReUpdate(); everything is performed, and if the race is still normally </div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;running the State Engine while loop will return into the same state again and </div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;again, till some condition for a state change is fulfilled (e.g. when the race </div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;has ended).</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;[ReUpdate](@ref ReUpdate) is located in src/libs/raceengineclient/raceengine.cpp. </div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;It has four </div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;distinct operating modes:</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;Interactive Mode</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;----------------</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;[RM_DISP_MODE_NORMAL](@ref RM_DISP_MODE_NORMAL):</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;This mode is mostly suitable for interactive </div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;simulations, it takes into account simulation time and real time. It basically </div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;works like this: Progress the simulation time until simulation time has caught up </div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;with real time, then render a frame.</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;Now this has some consequences, because </div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;TORCS is usually not the only running process in the operating environment and </div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;is usually not running as real time task. So if another process or the </div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;operating environment hooks up some resources, it might happen that TORCS sleeps </div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;for a moment, and after that nap it has to catch up. So a consequence of </div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;this mode is that even if you repeat runs of the exact same simulation in simulation time, </div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;that the rendered frames will quite likely not be the identical ones. This can </div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;have as well an impact on human player performance, if some frames take very </div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;long to appear. </div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;If you want to simulate a video source with exactly </div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;one frame every X seconds [RM_DISP_MODE_CAPTURE](@ref RM_DISP_MODE_CAPTURE) </div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;might be a better solution. </div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;[RM_DISP_MODE_NORMAL](@ref RM_DISP_MODE_NORMAL) mode has two more features: If</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;the simulation lags behind a </div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;lot and is not able to catch up, it spits out at least a frame on every 2000th </div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;time step, this is required to keep the GUI interactive (processing the event </div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;queue). There is as well a time warp (up to 128 times real time) and slow motion </div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;mode (down to 1/64 times real time).</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;Blind Mode</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;----------</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;[RM_DISP_MODE_NONE](@ref RM_DISP_MODE_NONE):</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;This mode is used for the &quot;blind mode&quot; in practice sessions, it does just </div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;consider simulation time, no 3D scenery is rendered. Every 2 seconds of </div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;simulation time the list in the GUI regarding the current progress is </div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;updated. This mode is suitable for development of robots. You can run </div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;experiments with almost no overhead, but you can switch quickly in the GUI </div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;between runs from and back to [RM_DISP_MODE_NORMAL](@ref RM_DISP_MODE_NORMAL) </div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;to investigate problems.</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;Frame Capturing Mode</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;--------------------</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;[RM_DISP_MODE_CAPTURE](@ref RM_DISP_MODE_CAPTURE):</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;This mode is used to capture frames at exact points in simulation time (e.g. </div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;every 0.03s). The time is not synchronized with real time, so the simulation </div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;might be faster or slower than real time, depending on the load you generate. </div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;Time warp and slow motion modes are available as well. This would be with some </div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;little modification the most suitable mode for creating an AI driving based on </div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;video frames.</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;Console Mode</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;------------</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;[RM_DISP_MODE_CONSOLE](@ref RM_DISP_MODE_CONSOLE):</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;This mode is used when you start TORCS with the -r option from the command </div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;line, it does have no GUI at all, it just prints out some progress information. </div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;This mode is intended for batch operation and unit testing.</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;Simulation Time Step</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;--------------------</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;As you can see in all these modes, [ReOneStep](@ref ReOneStep) in </div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;src/libs/raceengineclient/raceengine.cpp is then called at some point, this </div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;actually executes the simulation time step. Here is a good point to set a </div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;break point to investigate the call stack when you are new to the TORCS code</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;base.</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;The discretisation and simulation loop has another consequence which is to </div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;consider: Lets assume that we disable everything which changes car properties, </div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;so we have no damage, use no fuel, etc. Now you would expect that a </div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;non learning, perfect controlled, hard coded robot would drive lap by lap the </div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;same lap (and lap time), would you? But that is not the case. Lets assume that </div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;we hit on our Nth lap accidently exactly the starting line with the car center, </div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;and let us draw a point on every simulated time step on the track. Now when we </div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;finish the Nth lap it is very unlikely that we hit exactly the same point where </div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;we started because of time discretisation, so every consecutive lap will be </div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;similar but not identical.</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;Simulation time limits: Because the simulation time is represented as double, </div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;and the simulation time step is finite ([RCM_MAX_DT_SIMU](@ref RCM_MAX_DT_SIMU))</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;applications are expected to run stable  up to 1 Million Days simulation time</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;(the simulation core itself does only depend on the time step, so it would run</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;stable for ever). The longest known performed experiments are 100000 km races in</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;command line mode.</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;@author Bernhard Wymann</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="architecture_8md.html">architecture.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
